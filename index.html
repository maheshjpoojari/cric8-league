<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cric-8 Pro Scorer</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background: #0f172a; color: white; text-align: center; margin: 0; padding: 10px; }
        .hidden { display: none !important; }
        .setup-screen, .game-screen { max-width: 500px; margin: auto; }
        input { padding: 10px; margin: 5px; width: 85%; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; }
        .match-header { background: #1e293b; padding: 12px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #334155; }
        .score-box { background: #1e293b; padding: 15px; border-radius: 20px; margin: 10px 0; border: 1px solid #334155; }
        #totalScore { font-size: 3.5rem; font-weight: 800; margin: 5px 0; color: #38bdf8; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        button { padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .run-btn { background: #334155; color: white; }
        .wicket-btn { background: #ef4444; color: white; grid-column: span 3; }
        .mankad-btn { background: #991b1b; color: white; grid-column: span 3; }
        .extra-btn { background: #f59e0b; color: #000; }
        .dot-indicator { font-size: 1.2rem; margin-top: 5px; letter-spacing: 5px; }
        table { width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 0.9rem; }
        th, td { border: 1px solid #334155; padding: 8px; }
        .active-striker { color: #fbbf24; font-weight: bold; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

    <div id="setupScreen" class="setup-screen">
        <h2 style="color: #38bdf8;">Match Setup</h2>
        <input type="text" id="teamA" placeholder="Batting Team Name">
        <input type="text" id="teamB" placeholder="Bowling Team Name">
        <div id="playerInputs"></div>
        <button style="background:#10b981; color:white; width:90%; height:50px; margin-top:20px;" onclick="startGame()">START MATCH</button>
    </div>

    <div id="gameScreen" class="game-screen hidden">
        <div class="match-header">
            <div id="vsDisp" style="color:#38bdf8; font-weight:bold;"></div>
            <div style="display:flex; justify-content:space-around; margin-top:10px;">
                <div id="s1Disp" onclick="setStriker(0)">-</div>
                <div id="s2Disp" onclick="setStriker(1)">-</div>
            </div>
        </div>
        
        <div class="score-box">
            <div id="totalScore">0</div>
            <div>Overs: <span id="ovDisp">0.0</span>/8.0 | Wkts: <span id="wkDisp">0</span></div>
            <div id="dotDisp" class="dot-indicator">âšª âšª âšª</div>
        </div>

        <div class="grid">
            <button class="run-btn" onclick="addBall('RUN', 0)">0</button>
            <button class="run-btn" onclick="addBall('RUN', 1)">1</button>
            <button class="run-btn" onclick="addBall('RUN', 2)">2</button>
            <button class="run-btn" onclick="addBall('RUN', 4)">4</button>
            <button class="run-btn" onclick="addBall('RUN', 6)">6</button>
            <button class="extra-btn" onclick="addBall('WIDE')">WIDE+2</button>
            <button class="extra-btn" onclick="addBall('NOBALL')">NB+2</button>
            <button class="wicket-btn" onclick="addBall('WICKET')">WICKET/RUN-OUT (-5)</button>
            <button class="mankad-btn" onclick="addBall('MANKAD')">MANKAD (-5)</button>
        </div>
        <button class="run-btn" style="width:100%; margin-top:10px;" onclick="undo()">UNDO</button>

        <table>
            <thead><tr><th>Player</th><th>Runs</th><th>Balls</th></tr></thead>
            <tbody id="statsBody"></tbody>
        </table>
    </div>

    <script>
        let players = [], currentPair = [], strikerIdx = 0, dotCounter = 0, history = [];
        let state = { score: 0, balls: 0, wickets: 0, pStats: {} };

        const inputDiv = document.getElementById('playerInputs');
        for(let i=0; i<10; i++) inputDiv.innerHTML += `<input type="text" id="p${i}" placeholder="Player ${i+1}">`;

        function startGame() {
            const tA = document.getElementById('teamA').value || "Team A";
            const tB = document.getElementById('teamB').value || "Team B";
            document.getElementById('vsDisp').innerText = `${tA} vs ${tB}`;
            
            for(let i=0; i<10; i++) {
                let name = document.getElementById(`p${i}`).value || `P${i+1}`;
                players.push(name);
                state.pStats[name] = { runs: 0, balls: 0 };
            }
            currentPair = [players[0], players[1]];
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            updateDisplay();
        }

        function setStriker(idx) { strikerIdx = idx; updateDisplay(); }

        function updateDisplay() {
            document.getElementById('totalScore').innerText = state.score;
            document.getElementById('ovDisp').innerText = `${Math.floor(state.balls / 6)}.${state.balls % 6}`;
            document.getElementById('wkDisp').innerText = state.wickets;
            
            document.getElementById('s1Disp').innerText = currentPair[0] + (strikerIdx === 0 ? " ðŸ" : "");
            document.getElementById('s2Disp').innerText = currentPair[1] + (strikerIdx === 1 ? " ðŸ" : "");
            document.getElementById('s1Disp').className = strikerIdx === 0 ? 'active-striker' : '';
            document.getElementById('s2Disp').className = strikerIdx === 1 ? 'active-striker' : '';

            let dots = ["âšª", "âšª", "âšª"];
            for(let i=0; i<dotCounter; i++) dots[i] = "ðŸ”´";
            document.getElementById('dotDisp').innerText = dots.join(" ");

            let html = "";
            players.forEach(p => {
                html += `<tr><td>${p}</td><td>${state.pStats[p].runs}</td><td>${state.pStats[p].balls}</td></tr>`;
            });
            document.getElementById('statsBody').innerHTML = html;
        }

        function addBall(type, runs = 0) {
            history.push(JSON.parse(JSON.stringify({ state, strikerIdx, dotCounter, currentPair })));
            let striker = currentPair[strikerIdx];
            let nonStriker = currentPair[strikerIdx === 0 ? 1 : 0];
            let isOver8 = state.balls >= 42;

            if (type === 'RUN') {
                state.score += runs;
                state.pStats[striker].runs += runs;
                state.pStats[striker].balls++;
                state.balls++;
                if (runs === 0) {
                    dotCounter++;
                } else {
                    dotCounter = 0;
                    if (runs % 2 !== 0) strikerIdx = strikerIdx === 0 ? 1 : 0;
                }
            } 
            else if (type === 'WICKET') {
                state.score -= 5;
                state.pStats[striker].runs -= 5;
                state.pStats[striker].balls++;
                state.balls++;
                state.wickets++;
                dotCounter = 0;
            } 
            else if (type === 'MANKAD') {
                state.score -= 5;
                state.pStats[nonStriker].runs -= 5;
                state.wickets++;
                // Ball not counted as per rule table
            } 
            else if (type === 'WIDE' || type === 'NOBALL') {
                state.score += 2;
                dotCounter = 0;
                if (!isOver8) state.balls++; // Counted in overs 1-7
                // Not counted in Over 8
            }

            // 3 Dots Rule logic
            if (dotCounter === 3) {
                alert("3 Consecutive Dots! -5 Penalty");
                state.score -= 5;
                state.pStats[striker].runs -= 5;
                dotCounter = 0;
            }

            // Automatic pair rotation every 12 balls (2 overs)
            if (state.balls > 0 && state.balls % 12 === 0 && history[history.length-1].state.balls !== state.balls) {
                let pairNum = state.balls / 12;
                if (pairNum < 4) {
                    currentPair = [players[pairNum * 2], players[pairNum * 2 + 1]];
                    strikerIdx = 0;
                }
            }
            updateDisplay();
        }

        function undo() {
            if (history.length > 0) {
                let prev = history.pop();
                state = prev.state;
                strikerIdx = prev.strikerIdx;
                dotCounter = prev.dotCounter;
                currentPair = prev.currentPair;
                updateDisplay();
            }
        }
    </script>
</body>
</html>
