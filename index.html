<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cric-8 Pro Scorer</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background: #0f172a; color: white; text-align: center; margin: 0; padding: 10px; }
        .hidden { display: none !important; }
        .setup-screen, .game-screen { max-width: 500px; margin: auto; }
        input { padding: 12px; margin: 5px; width: 85%; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white; }
        
        /* Match Header Styles */
        .match-header { background: #1e293b; padding: 12px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #334155; }
        #teamNameDisp { margin: 0; color: #38bdf8; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }
        .batsman-pair { display: flex; justify-content: space-around; margin-top: 10px; font-size: 1rem; border-top: 1px solid #334155; padding-top: 10px; }
        .active-striker { color: #fbbf24; font-weight: bold; }
        .non-striker { color: #cbd5e1; opacity: 0.8; }

        .score-box { background: #1e293b; padding: 15px; border-radius: 20px; margin: 10px 0; border: 1px solid #334155; position: relative; }
        #totalScore { font-size: 4rem; font-weight: 800; margin: 5px 0; color: #38bdf8; }
        .negative { color: #f87171 !important; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        button { padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 1rem; }
        button:active { transform: scale(0.95); }
        .run-btn { background: #334155; color: white; }
        .wicket-btn { background: #ef4444; color: white; grid-column: span 3; }
        .extra-btn { background: #f59e0b; color: #000; }
        
        table { width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 0.85rem; background: #1e293b; border-radius: 10px; overflow: hidden; }
        th, td { border: 1px solid #334155; padding: 10px; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; padding: 20px; }
    </style>
</head>
<body>

    <div id="setupScreen" class="setup-screen">
        <h2 style="color: #38bdf8;">Cric-8 Setup</h2>
        <div id="playerInputs"></div>
        <button style="background:#10b981; color:white; width:90%; margin-top:15px; height:55px;" onclick="startGame()">START MATCH</button>
    </div>

    <div id="gameScreen" class="game-screen hidden">
        <div class="match-header">
            <h2 id="teamNameDisp">TEAM NAME</h2>
            <div class="batsman-pair">
                <div id="strikerDisp" class="active-striker">üèè Batsman 1*</div>
                <div id="nonStrikerDisp" class="non-striker">Batsman 2</div>
            </div>
        </div>
        
        <div class="score-box">
            <div id="totalScore">0</div>
            <div style="font-weight:bold; opacity:0.8;">
                Overs: <span id="ovDisp">0.0</span>/8.0 | Wkts: <span id="wkDisp">0</span>
            </div>
        </div>

        <div class="grid">
            <button class="run-btn" onclick="addBall('RUN', 0)">0</button>
            <button class="run-btn" onclick="addBall('RUN', 1)">1</button>
            <button class="run-btn" onclick="addBall('RUN', 2)">2</button>
            <button class="run-btn" onclick="addBall('RUN', 4)">4</button>
            <button class="run-btn" onclick="addBall('RUN', 6)">6</button>
            <button class="extra-btn" onclick="addBall('WIDE')">WIDE+2</button>
            <button class="extra-btn" onclick="addBall('NOBALL')">NB+2</button>
            <button class="wicket-btn" onclick="addBall('WICKET')">WICKET/RUN-OUT (-5)</button>
            <button class="wicket-btn" style="background:#991b1b; height:45px;" onclick="addBall('MANKAD')">MANKAD (-5, No Ball Counted)</button>
        </div>

        <button class="run-btn" style="width:100%; margin-top:10px;" onclick="undo()">UNDO LAST BALL</button>

        <table id="statsTable">
            <thead><tr><th>Player</th><th>Runs</th><th>W</th><th>RC</th></tr></thead>
            <tbody id="statsBody"></tbody>
        </table>
    </div>

    <script>
        let players = [], history = [], innings = 1;
        let state = { score: 0, balls: 0, wickets: 0, pStats: [] };

        // Generate inputs for 8 players
        const inputDiv = document.getElementById('playerInputs');
        for(let i=0; i<8; i++) {
            inputDiv.innerHTML += `<input type="text" id="p${i}" placeholder="Player ${i+1} Name">`;
        }

        function startGame() {
            players = [];
            for(let i=0; i<8; i++) {
                players.push(document.getElementById(`p${i}`).value || `Player ${i+1}`);
            }
            initInnings();
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
        }

        function initInnings() {
            state = { 
                score: 0, 
                balls: 0, 
                wickets: 0, 
                pStats: players.map(() => ({ runs: 0, w: 0, rc: 0 })) 
            };
            updateDisplay();
        }

        function updateDisplay() {
            // Update Score & Overs
            document.getElementById('totalScore').innerText = state.score;
            document.getElementById('totalScore').className = state.score < 0 ? 'negative' : '';
            document.getElementById('ovDisp').innerText = `${Math.floor(state.balls / 6)}.${state.balls % 6}`;
            document.getElementById('wkDisp').innerText = state.wickets;

            // Update Team Name
            document.getElementById('teamNameDisp').innerText = (innings === 1) ? "Team 1 Batting" : "Team 2 Batting";

            // Update Batsman Pair Display
            let pairIdx = Math.min(Math.floor(state.balls / 12), 3);
            let s1 = players[pairIdx * 2];
            let s2 = players[pairIdx * 2 + 1];

            if (state.balls % 2 === 0) {
                document.getElementById('strikerDisp').innerHTML = `üèè ${s1}*`;
                document.getElementById('strikerDisp').className = 'active-striker';
                document.getElementById('nonStrikerDisp').innerText = s2;
                document.getElementById('nonStrikerDisp').className = 'non-striker';
            } else {
                document.getElementById('strikerDisp').innerText = s1;
                document.getElementById('strikerDisp').className = 'non-striker';
                document.getElementById('nonStrikerDisp').innerHTML = `üèè ${s2}*`;
                document.getElementById('nonStrikerDisp').className = 'active-striker';
            }

            // Update Stats Table
            let html = "";
            players.forEach((p, i) => {
                html += `<tr><td>${p}</td><td>${state.pStats[i].runs}</td><td>${state.pStats[i].w}</td><td>${state.pStats[i].rc}</td></tr>`;
            });
            document.getElementById('statsBody').innerHTML = html;
        }

        function addBall(type, runs = 0) {
            // Save history for UNDO
            history.push(JSON.parse(JSON.stringify(state)));
            
            let pairIdx = Math.min(Math.floor(state.balls / 12), 3);
            let strikerIdx = (state.balls % 2 === 0) ? (pairIdx * 2) : (pairIdx * 2 + 1);
            let currentBowlerIdx = (Math.floor(state.balls / 6) % 8); // Simple bowler rotation logic

            if (type === 'RUN') {
                state.score += runs;
                state.pStats[strikerIdx].runs += runs;
                state.balls += 1;
            } else if (type === 'WICKET') {
                state.score -= 5;
                state.pStats[strikerIdx].runs -= 5;
                state.balls += 1;
                state.wickets += 1;
            } else if (type === 'WIDE') {
                state.score += 2;
                // Wide logic usually doesn't count the ball unless specified, 
                // but based on your request for NB, we keep Wide as per standard or adjust if needed.
                state.balls += 1; 
            } else if (type === 'NOBALL') {
                // NEW RULE: +2 Runs and Ball is Counted
                state.score += 2;
                state.balls += 1; 
            } else if (type === 'MANKAD') {
                state.score -= 5;
                state.wickets += 1;
                // Mankad usually doesn't count as a ball bowled
            }

            if (state.balls >= 48) {
                alert("Innings Over!");
            }
            updateDisplay();
        }

        function undo() {
            if (history.length > 0) {
                state = history.pop();
                updateDisplay();
            }
        }
    </script>
</body>
</html>
