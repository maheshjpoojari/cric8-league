<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cric-8 Tournament Scorer</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background: #0f172a; color: white; text-align: center; margin: 0; padding: 10px; }
        .hidden { display: none !important; }
        .setup-screen, .game-screen { max-width: 500px; margin: auto; }
        input { padding: 12px; margin: 5px; width: 42%; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white; }
        
        .match-header { background: #1e293b; padding: 12px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #334155; }
        #vsDisp { color: #38bdf8; font-size: 1.2rem; font-weight: bold; margin-bottom: 8px; }
        .batsman-pair { display: flex; justify-content: space-around; margin-top: 10px; border-top: 1px solid #475569; padding-top: 10px; }
        .active-striker { color: #fbbf24; font-weight: bold; text-decoration: underline; cursor: pointer; }
        .non-striker { color: #cbd5e1; cursor: pointer; }

        .score-box { background: #1e293b; padding: 15px; border-radius: 20px; margin: 10px 0; border: 1px solid #334155; }
        #totalScore { font-size: 3.5rem; font-weight: 800; margin: 5px 0; color: #38bdf8; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        button { padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .run-btn { background: #334155; color: white; }
        .wicket-btn { background: #ef4444; color: white; grid-column: span 3; }
        .extra-btn { background: #f59e0b; color: #000; }
        .sub-btn { background: #10b981; color: white; padding: 4px 8px; font-size: 0.7rem; border-radius: 4px; }
        
        table { width: 100%; margin-top: 15px; font-size: 0.8rem; background: #1e293b; border-collapse: collapse; }
        th, td { border: 1px solid #334155; padding: 8px; }
    </style>
</head>
<body>

    <div id="setupScreen" class="setup-screen">
        <h2 style="color: #38bdf8;">Match Setup</h2>
        <input type="text" id="teamA" placeholder="Team A Name" style="width: 88%;">
        <input type="text" id="teamB" placeholder="Team B Name" style="width: 88%;">
        <h3 style="margin-top:20px;">Register 10 Players (8 Squad + 2 Sub)</h3>
        <div id="playerInputs"></div>
        <button style="background:#10b981; color:white; width:90%; margin-top:20px; height:50px;" onclick="startGame()">START MATCH</button>
    </div>

    <div id="gameScreen" class="game-screen hidden">
        <div class="match-header">
            <div id="vsDisp">TEAM A VS TEAM B</div>
            <div id="battingTeam" style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 5px;"></div>
            <div class="batsman-pair">
                <div id="s1Disp" onclick="setStriker(0)">Batsman 1</div>
                <div id="s2Disp" onclick="setStriker(1)">Batsman 2</div>
            </div>
            <p style="font-size: 0.7rem; color: #64748b; margin-top: 5px;">(Click name to change strike)</p>
        </div>
        
        <div class="score-box">
            <div id="totalScore">0</div>
            <div>Overs: <span id="ovDisp">0.0</span>/8.0 | Wkts: <span id="wkDisp">0</span></div>
        </div>

        <div class="grid">
            <button class="run-btn" onclick="addBall('RUN', 0)">0</button>
            <button class="run-btn" onclick="addBall('RUN', 1)">1</button>
            <button class="run-btn" onclick="addBall('RUN', 2)">2</button>
            <button class="run-btn" onclick="addBall('RUN', 4)">4</button>
            <button class="run-btn" onclick="addBall('RUN', 6)">6</button>
            <button class="extra-btn" onclick="addBall('WIDE')">WIDE+2</button>
            <button class="extra-btn" onclick="addBall('NOBALL')">NB+2</button>
            <button class="wicket-btn" onclick="addBall('WICKET')">WICKET (-5)</button>
        </div>
        <button class="run-btn" style="width:100%; margin-top:10px;" onclick="undo()">UNDO</button>

        <table>
            <thead><tr><th>Player</th><th>Runs</th><th>W</th><th>Status</th></tr></thead>
            <tbody id="statsBody"></tbody>
        </table>
    </div>

    <script>
        let teamA, teamB, players = [], strikerIndex = 0;
        let state = { score: 0, balls: 0, wickets: 0, pStats: [], activeSquad: [0,1,2,3,4,5,6,7], subs: [8,9] };
        let history = [];

        const inputDiv = document.getElementById('playerInputs');
        for(let i=0; i<10; i++) {
            inputDiv.innerHTML += `<input type="text" id="p${i}" placeholder="P${i+1} Name">`;
        }

        function startGame() {
            teamA = document.getElementById('teamA').value || "Team A";
            teamB = document.getElementById('teamB').value || "Team B";
            for(let i=0; i<10; i++) players.push(document.getElementById(`p${i}`).value || `P${i+1}`);
            
            initStats();
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('vsDisp').innerText = `${teamA} VS ${teamB}`;
            updateDisplay();
        }

        function initStats() {
            state.pStats = players.map(name => ({ name, runs: 0, w: 0 }));
        }

        function setStriker(idx) {
            strikerIndex = idx;
            updateDisplay();
        }

        function swapPlayer(activeIdx) {
            let newSub = state.activeSquad[activeIdx];
            let incoming = state.subs.shift();
            state.activeSquad[activeIdx] = incoming;
            state.subs.push(newSub);
            alert(`${players[newSub]} replaced by ${players[incoming]}`);
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('totalScore').innerText = state.score;
            document.getElementById('ovDisp').innerText = `${Math.floor(state.balls / 6)}.${state.balls % 6}`;
            document.getElementById('wkDisp').innerText = state.wickets;

            // Update Striker Selection
            let pairIdx = Math.min(Math.floor(state.balls / 12), 3);
            let b1 = players[state.activeSquad[pairIdx * 2]];
            let b2 = players[state.activeSquad[pairIdx * 2 + 1]];
            
            document.getElementById('s1Disp').innerText = b1 + (strikerIndex === 0 ? " ðŸ" : "");
            document.getElementById('s2Disp').innerText = b2 + (strikerIndex === 1 ? " ðŸ" : "");
            document.getElementById('s1Disp').className = strikerIndex === 0 ? 'active-striker' : 'non-striker';
            document.getElementById('s2Disp').className = strikerIndex === 1 ? 'active-striker' : 'non-striker';

            // Stats Table
            let html = "";
            state.activeSquad.forEach((pIdx, i) => {
                let p = state.pStats[pIdx];
                html += `<tr><td>${p.name}</td><td>${p.runs}</td><td>${p.w}</td>
                         <td><button class="sub-btn" onclick="swapPlayer(${i})">SUB</button></td></tr>`;
            });
            document.getElementById('statsBody').innerHTML = html;
        }

        function addBall(type, runs = 0) {
            history.push(JSON.parse(JSON.stringify(state)));
            let pairIdx = Math.min(Math.floor(state.balls / 12), 3);
            let actualStriker = state.activeSquad[pairIdx * 2 + strikerIndex];

            if (type === 'RUN') {
                state.score += runs;
                state.pStats[actualStriker].runs += runs;
                state.balls += 1;
                if (runs % 2 !== 0) strikerIndex = strikerIndex === 0 ? 1 : 0; // Auto-rotate on odd runs
            } else if (type === 'WICKET') {
                state.score -= 5;
                state.pStats[actualStriker].runs -= 5;
                state.balls += 1;
                state.wickets += 1;
            } else if (type === 'WIDE' || type === 'NOBALL') {
                state.score += 2;
                state.balls += 1;
            }
            updateDisplay();
        }

        function undo() {
            if (history.length > 0) {
                state = history.pop();
                updateDisplay();
            }
        }
    </script>
</body>
</html>
